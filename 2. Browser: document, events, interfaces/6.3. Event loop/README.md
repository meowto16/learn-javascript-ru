# Событийный цикл: микрозадачи и макрозадачи

Есть бесконечный цикл, в котором движок JS ожидает задачи, исполняет их и снова ожидает появления новых.

Общий алгоритм движка:

1. Пока есть задачи - выполнить их начиная с самой старой
2. Бездействовать до появления новой задачи, затем перейти к пункту 1.

Может так случиться, что задача поступает, когда движок занят чем-то другим, тогда она ставится в очередь.
Очередь, которую формируют такие задачи, называют **«очередью макрозадач»** (macrotask queue, термин v8).

Примеры макрозадач:

- `mousemove`
- `setTimeout`

> Рендеринг не происходит во время выполнения задачи движком. Не важно насколько долго выполняется задача, изменений в 
> DOM не будет.
> 
> Если задача слишком долгая - браузер предложит "убить" её. 

Микрозадачи приходят только из кода. 
Обычно они создаются промисами: выполнение обработчика .then/catch/finally становится микрозадачей.

Также есть специальная функция `queueMicrotask(func)`, которая помещает func в очередь микрозадач.

> Сразу после каждой макрозадачи,
> движок исполняет все задачи из очереди микрозадач.

> Для длительных тяжёлых вычислений, которые не должны блокировать событийный цикл, 
> мы можем использовать Web Workers.
> 
> Это способ исполнить код в другом потоке. Они могут обмениваться через события с основным потоком.
