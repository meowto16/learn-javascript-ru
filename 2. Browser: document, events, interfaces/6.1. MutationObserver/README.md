# MutationObserver: наблюдатель за изменениями

`MutationObserver` – это встроенный объект, наблюдающий за DOM-элементом и запускающий callback в случае изменений.

## Как работает

Создаем `observer`:

```js
let observer = new MutationObserver(callback);
```

Затем прикрепляем к любой ноде:
```js
observer.observe(node, config);
```

`config` - это объект с булевыми параметрами «на какие изменения реагировать»:

- `childList` - изменения в непосредственных детях `node`
- `subtree` - во всех потомках `node`
- `attributes` -  в атрибутах `node`
- `attributeFilter` - массив имён атрибутов, чтобы наблюдать только за выбранными.
- `characterData` - наблюдать ли за `node.data` (текстовое содержимое)
- `characterDataOldValue` - `будет передавать и старое и новое значение node.data` в callback
- `attributeOldValue` - будет передавать и старое и новое старое значение атрибута в callback

Когда выполняется callback, в который изменения передаются первым аргументом как список объектов
`MutationRecord`. Сам наблюдатель идет вторым аргументом.

Объекты `MutationRecord` имеют следующие свойства:

- `type` - тип изменения, один из:
  - `attributes` - изменен аттрибут
  - `characterData` - изменены данные `elem.data`, это для текстовых узлов
  - `childList` - добавлены/удалены дочерние элементы
- `target` - где произошло изменение: элемент для `attributes`, текстовый узел для `characterData`
или элемент для `childList`
- `addedNodes/removedNodes` - добавленные/удаленные узлы
- `previousSibling/nextSibling` - предыдущий или следующий одноуровневый элемент для добавленных, удаленных элементов
- `attributeName/attributeNamespace` - имя/пространство имен для измененного атрибута
- `oldValue` - предыдущее значение, если включена нужная опция `characterData/characterDataOldValue`

## Зачем нужен

В основном нужен, когда есть какие-то сторонние скрипты, влияния на них нет, но повлиять через
DOM-элементы на них нужно.

## Дополнительные методы

- `observer.disconnect()` - останавливает наблюдение
- `mutationRecords = observer.takeRecords()` - получает список необработанных записей изменений, которые произошли, 
   но колбэк для них ещё не выполнился.

## Сборка мусора

Если узел удалён из `DOM` и больше не достижим, то он будет удалён из памяти вне зависимости от наличия наблюдателя.



